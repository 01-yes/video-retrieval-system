# ğŸ¬ åŒè¯­ä¹‰è§†é¢‘æ£€ç´¢ç³»ç»Ÿ

ä¸€ä¸ªåŸºäºä¼ ç»Ÿè§†è§‰ç‰¹å¾å’ŒCLIPæ·±åº¦ç‰¹å¾çš„åŒè¯­ä¹‰è§†é¢‘æ£€ç´¢ç³»ç»Ÿï¼Œæ”¯æŒæ™ºèƒ½æƒé‡è°ƒèŠ‚å’Œå¤šç»´åº¦ç›¸ä¼¼åº¦åˆ†æã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ¯ **åŒè¯­ä¹‰æ£€ç´¢**: ç»“åˆä¼ ç»Ÿè§†è§‰ç‰¹å¾ï¼ˆé¢œè‰²ã€çº¹ç†ã€ç»Ÿè®¡ï¼‰å’ŒCLIPæ·±åº¦è¯­ä¹‰ç‰¹å¾
- âš–ï¸ **æ™ºèƒ½æƒé‡è°ƒèŠ‚**: åŠ¨æ€è°ƒæ•´ä¼ ç»Ÿç‰¹å¾å’ŒCLIPç‰¹å¾çš„æƒé‡æ¯”ä¾‹
- ğŸš€ **é«˜æ•ˆæ£€ç´¢**: åŸºäºä½™å¼¦ç›¸ä¼¼åº¦çš„å¿«é€Ÿè§†é¢‘ç›¸ä¼¼æ€§æœç´¢
- ğŸ“Š **å¤šç»´åº¦åˆ†æ**: æ˜¾ç¤ºç»¼åˆç›¸ä¼¼åº¦åŠå„ç‰¹å¾åˆ†é‡ç›¸ä¼¼åº¦
- ğŸ› ï¸ **çµæ´»é…ç½®**: æ”¯æŒå¤šç§æƒé‡é…ç½®æ¯”è¾ƒå’Œæ•ˆæœè¯„ä¼°

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

project1/
â”œâ”€â”€src/                          # æºä»£ç ç›®å½•
â”‚â”œâ”€â”€ feature_extractor.py     # ä¸»ç‰¹å¾æå–å™¨ï¼ˆä¼ ç»Ÿ + CLIPï¼‰
â”‚â”œâ”€â”€ clip_extractor.py        # CLIPæ·±åº¦ç‰¹å¾æå–å™¨
â”‚â””â”€â”€ retrieval.py             # åŒç‰¹å¾æ£€ç´¢ç³»ç»Ÿ
â”œâ”€â”€outputs/                     # ç‰¹å¾å­˜å‚¨ç›®å½•
â”œâ”€â”€data/                        # è§†é¢‘æ•°æ®ç›®å½•
â”œâ”€â”€demo.py                      # ç³»ç»Ÿæ¼”ç¤ºè„šæœ¬
â”œâ”€â”€main.py                      # äº¤äº’å¼ä¸»ç¨‹åº
â”œâ”€â”€test_clip.py                 # CLIPåŠŸèƒ½æµ‹è¯•
â”œâ”€â”€install_clip_with_mirror.py  # CLIPå®‰è£…å·¥å…·
â””â”€â”€README.md                    # é¡¹ç›®æ–‡æ¡£


## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.7+
- CUDAï¼ˆå¯é€‰ï¼Œç”¨äºGPUåŠ é€Ÿï¼‰

### å®‰è£…ä¾èµ–

```bash
pip install opencv-python numpy open-clip-torch torch torchvision pillow
```

å¿«é€Ÿæµ‹è¯•

1. æµ‹è¯•CLIPåŠŸèƒ½ï¼š

```bash
python test_clip.py
```

1. è¿è¡Œç³»ç»Ÿæ¼”ç¤ºï¼š

```bash
python demo.py
```

1. ä½¿ç”¨äº¤äº’å¼ç³»ç»Ÿï¼š

```bash
python main.py
```

ğŸ“– è¯¦ç»†ä½¿ç”¨æ–¹æ³•

ç‰¹å¾æå–

```python
from src.feature_extractor import VideoFeatureExtractor

# åˆå§‹åŒ–ç‰¹å¾æå–å™¨
extractor = VideoFeatureExtractor(use_clip=True)

# æå–å•ä¸ªè§†é¢‘ç‰¹å¾
features = extractor.extract_features("path/to/video.mp4")

# æ‰¹é‡æå–ç‰¹å¾
video_paths = ["video1.mp4", "video2.mp4", "video3.mp4"]
features_dict = extractor.extract_features_batch(video_paths)

# ä¿å­˜ç‰¹å¾
import numpy as np
np.save("outputs/video_features.npy", features_dict)
```

è§†é¢‘æ£€ç´¢

```python
from src.retrieval import VideoRetrievalSystem

# åˆå§‹åŒ–æ£€ç´¢ç³»ç»Ÿ
retrieval_system = VideoRetrievalSystem(
    features_path="outputs/video_features.npy",
    clip_weight=0.5  # CLIPç‰¹å¾æƒé‡
)

# æ–¹æ³•1ï¼šé€šè¿‡è§†é¢‘åç§°æŸ¥è¯¢
results = retrieval_system.query_by_example("query_video.mp4", top_k=5)

# æ–¹æ³•2ï¼šè°ƒæ•´æƒé‡
retrieval_system.set_weights(traditional_weight=0.8, clip_weight=0.2)

# æ–¹æ³•3ï¼šæ¯”è¾ƒä¸åŒæƒé‡é…ç½®
weight_configs = [
    (0.8, 0.2, "ä¾§é‡ä¼ ç»Ÿç‰¹å¾"),
    (0.5, 0.5, "å¹³è¡¡æƒé‡"), 
    (0.2, 0.8, "ä¾§é‡CLIPè¯­ä¹‰")
]
retrieval_system.compare_weight_configs("query_video.mp4", weight_configs)
```

äº¤äº’å¼ä½¿ç”¨

è¿è¡Œ python main.py åï¼Œç³»ç»Ÿæä¾›ä»¥ä¸‹èœå•ï¼š

```
ä¸»èœå•:
1. ç‰¹å¾æå–æµæ°´çº¿
2. è§†é¢‘æ£€ç´¢æ¼”ç¤º
3. ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
4. è¿è¡Œå®Œæ•´æ¼”ç¤º (æå–+æ£€ç´¢)
5. é€€å‡º
```

ğŸ›ï¸ ç‰¹å¾æƒé‡é…ç½®æŒ‡å—

åœºæ™¯ ä¼ ç»Ÿæƒé‡ CLIPæƒé‡ é€‚ç”¨æƒ…å†µ
è§†è§‰ç›¸ä¼¼æ£€ç´¢ 0.8-0.9 0.1-0.2 é¢œè‰²ã€çº¹ç†ã€å½¢çŠ¶ç›¸ä¼¼æ€§æ£€ç´¢
è¯­ä¹‰ç›¸ä¼¼æ£€ç´¢ 0.1-0.2 0.8-0.9 å†…å®¹æ¦‚å¿µã€åœºæ™¯è¯­ä¹‰æ£€ç´¢
å¹³è¡¡æ£€ç´¢ 0.4-0.6 0.4-0.6 ç»¼åˆè§†è§‰å’Œè¯­ä¹‰ç›¸ä¼¼æ€§
å¼ºä¼ ç»Ÿä¾§é‡ 0.9 0.1 ç²¾ç¡®è§†è§‰åŒ¹é…
å¼ºè¯­ä¹‰ä¾§é‡ 0.1 0.9 é«˜çº§æ¦‚å¿µåŒ¹é…

ğŸ“Š è¾“å‡ºç¤ºä¾‹

```
ğŸ” æŸ¥è¯¢è§†é¢‘: example_video.mp4
æ£€ç´¢è®¾ç½®: top_k=5, ä¼ ç»Ÿæƒé‡=0.50, CLIPæƒé‡=0.50

ğŸ“Š æ£€ç´¢ç»“æœ
============================================================
 1. similar_video1.mp4
     ç»¼åˆç›¸ä¼¼åº¦: 0.9234 (ä¼ ç»Ÿ: 0.8567, CLIP: 0.9901)
 2. similar_video2.mp4  
     ç»¼åˆç›¸ä¼¼åº¦: 0.8456 (ä¼ ç»Ÿ: 0.9123, CLIP: 0.7789)
 3. similar_video3.mp4
     ç»¼åˆç›¸ä¼¼åº¦: 0.7890 (ä¼ ç»Ÿ: 0.7456, CLIP: 0.8324)
```

ğŸ”§ æŠ€æœ¯ç»†èŠ‚

ä¼ ç»Ÿç‰¹å¾ç»„ä»¶

Â· é¢œè‰²ç‰¹å¾: HSVé¢œè‰²ç©ºé—´ç›´æ–¹å›¾ï¼ˆ150ç»´ï¼‰
Â· çº¹ç†ç‰¹å¾: HOGæ–¹å‘æ¢¯åº¦ç›´æ–¹å›¾ï¼ˆ1764ç»´ï¼‰
Â· ç»Ÿè®¡ç‰¹å¾: å‡å€¼ã€æ ‡å‡†å·®ã€ä¸­ä½æ•°ç­‰ï¼ˆ15ç»´ï¼‰

CLIPç‰¹å¾

Â· æ¨¡å‹: ViT-B/32
Â· ç‰¹å¾ç»´åº¦: 512ç»´
Â· é¢„å¤„ç†: å›¾åƒæ ‡å‡†åŒ–å’Œå°ºå¯¸è°ƒæ•´

ç›¸ä¼¼åº¦è®¡ç®—

Â· ç®—æ³•: ä½™å¼¦ç›¸ä¼¼åº¦
Â· å½’ä¸€åŒ–: L2å‘é‡å½’ä¸€åŒ–
Â· èåˆ: åŠ æƒå¹³å‡èåˆ

ğŸ› æ•…éšœæ’é™¤

å¸¸è§é—®é¢˜

1. CLIPåŠ è½½å¤±è´¥
   ```bash
   # è®¾ç½®é•œåƒæº
   set HF_ENDPOINT=https://hf-mirror.com
   # é‡æ–°å®‰è£…
   pip install --upgrade open-clip-torch torch
   ```
2. å†…å­˜ä¸è¶³
   Â· å‡å°‘åŒæ—¶å¤„ç†çš„è§†é¢‘æ•°é‡
   Â· é™ä½è§†é¢‘é‡‡æ ·ç‡ (sample_rateå‚æ•°)
   Â· ä½¿ç”¨CPUæ¨¡å¼
3. ç‰¹å¾æ–‡ä»¶ä¸å­˜åœ¨
   Â· ç¡®ä¿å…ˆè¿è¡Œç‰¹å¾æå–
   Â· æ£€æŸ¥æ–‡ä»¶è·¯å¾„æƒé™
4. è§†é¢‘æ ¼å¼ä¸æ”¯æŒ
   Â· ç¡®ä¿å·²å®‰è£…æ­£ç¡®çš„è§†é¢‘ç¼–è§£ç å™¨
   Â· å°è¯•ä½¿ç”¨å¸¸è§æ ¼å¼ (.mp4, .avi)

è°ƒè¯•å·¥å…·

```python
# æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
python -c "from src.feature_extractor import VideoFeatureExtractor; from src.retrieval import VideoRetrievalSystem; print('ç³»ç»Ÿæ­£å¸¸')"

# æµ‹è¯•CLIP
python test_clip.py

# å®‰è£…CLIPï¼ˆç½‘ç»œé—®é¢˜ï¼‰
python install_clip_with_mirror.py
```

ğŸ“ æ–‡ä»¶è¯´æ˜

Â· src/feature_extractor.py - ä¸»ç‰¹å¾æå–å™¨ï¼Œæ”¯æŒä¼ ç»Ÿ+CLIPç‰¹å¾
Â· src/clip_extractor.py - CLIPæ·±åº¦ç‰¹å¾æå–å™¨
Â· src/retrieval.py - åŒç‰¹å¾æ£€ç´¢ç³»ç»Ÿ
Â· demo.py - å®Œæ•´åŠŸèƒ½æ¼”ç¤º
Â· main.py - äº¤äº’å¼ä¸»ç¨‹åº
Â· test_clip.py - CLIPåŠŸèƒ½éªŒè¯
Â· install_clip_with_mirror.py - CLIPå®‰è£…è¾…åŠ©å·¥å…·

ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (git checkout -b feature/AmazingFeature)
3. æäº¤æ›´æ”¹ (git commit -m 'Add some AmazingFeature')
4. æ¨é€åˆ°åˆ†æ”¯ (git push origin feature/AmazingFeature)
5. å¼€å¯ Pull Request

ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯

ğŸ™ è‡´è°¢

Â· OpenCLIP - æä¾›CLIPæ¨¡å‹
Â· OpenCV - è®¡ç®—æœºè§†è§‰åº“
. DeepSeek - ä»£ç æ”¯æŒ

---

æ³¨æ„: é¦–æ¬¡è¿è¡ŒCLIPæ—¶ä¼šè‡ªåŠ¨ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹ï¼ˆçº¦1.4GBï¼‰ï¼Œè¯·ç¡®ä¿ç½‘ç»œè¿æ¥å’Œè¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ã€‚å¦‚é‡ç½‘ç»œé—®é¢˜ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨ä¼ ç»Ÿç‰¹å¾æ¨¡å¼ã€‚

```